{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the ExpenseWise application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user, matching Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "preferences": {
            "type": "object",
            "description": "User-specific application preferences.",
            "properties": {
                "currency": {
                    "type": "string",
                    "enum": ["USD", "EUR", "GBP", "JPY", "INR"]
                },
                "theme": {
                    "type": "string",
                    "enum": ["light", "dark", "auto"]
                }
            }
        }
      },
      "required": [
        "id",
        "email",
        "createdAt"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a transaction recorded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "type": {
            "type": "string",
            "enum": ["income", "expense"],
            "description": "The type of transaction."
        },
        "category": {
          "type": "string",
          "description": "Category of the transaction (e.g., 'Food', 'Income')."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction."
        },
        "date": {
          "type": "string",
          "description": "The date of the transaction.",
          "format": "date-time"
        },
        "receiptUrl": {
          "type": "string",
          "description": "URL of the receipt image stored in Firebase Storage.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "category",
        "amount",
        "description",
        "date"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of expenses.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category (e.g., 'Food', 'Transportation')."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Category). If null, the category is a default system category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Budget": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Budget",
      "type": "object",
      "description": "Represents a monthly budget for a specific category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the budget."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Budget)"
        },
        "category": {
          "type": "string",
          "description": "The category for this budget."
        },
        "amount": {
          "type": "number",
          "description": "The budgeted amount for the month."
        },
        "month": {
          "type": "number",
          "description": "The month for which the budget is set (1-12)."
        },
        "year": {
          "type": "number",
          "description": "The year for which the budget is set."
        }
      },
      "required": [
        "id",
        "userId",
        "category",
        "amount",
        "month",
        "year"
      ]
    },
    "MonthlySummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MonthlySummary",
      "type": "object",
      "description": "Represents a summary of a user's financial activity for a specific month.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the monthly summary."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N MonthlySummary)"
        },
        "month": {
          "type": "number",
          "description": "The month for which the summary is calculated (1-12)."
        },
        "year": {
          "type": "number",
          "description": "The year for which the summary is calculated."
        },
        "totalIncome": {
          "type": "number",
          "description": "The total income for the month."
        },
        "totalExpenses": {
          "type": "number",
          "description": "The total expenses for the month."
        },
        "balance": {
          "type": "number",
          "description": "The balance (income - expenses) for the month."
        }
      },
      "required": [
        "id",
        "userId",
        "month",
        "year",
        "totalIncome",
        "totalExpenses",
        "balance"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information, including app preferences. This collection uses the user's UID as the document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction data for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores categories for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Stores monthly budgets for specific categories.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "budgetId",
              "description": "The unique identifier for the budget."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/monthlySummaries/{monthlySummaryId}",
        "definition": {
          "entityName": "MonthlySummary",
          "schema": {
            "$ref": "#/backend/entities/MonthlySummary"
          },
          "description": "Stores monthly financial summaries for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "monthlySummaryId",
              "description": "The unique identifier for the monthly summary."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging. User data and their related sub-collections (transactions, categories, summaries) are stored under a top-level `users` collection, with each user's data isolated under a document identified by their UID. This path-based ownership (`/users/{userId}`) is fundamental to the security rules, ensuring users can only access their own data. The existence of a document at `/users/{userId}` is a prerequisite for accessing any sub-collections, creating a secure gateway. This design follows the principle of Authorization Independence, as all necessary data for authorization is contained within the path or the document itself, avoiding costly and complex cross-document reads in security rules."
  }
}
